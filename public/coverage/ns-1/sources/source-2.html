


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GameService</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">service</a>
</div>

<h1>Coverage Summary for Class: GameService (service)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">GameService</td>
<td class="coverageStat">
  <span class="percent">
    57,1%
  </span>
  <span class="absValue">
    (4/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    19,1%
  </span>
  <span class="absValue">
    (13/68)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    53,8%
  </span>
  <span class="absValue">
    (42/78)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    54,6%
  </span>
  <span class="absValue">
    (287/526)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GameService$endGame$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameService$endTurn$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameService$startNewGame$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameService$startTurn$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameService$startTurn$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    33,3%
  </span>
  <span class="absValue">
    (4/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    19,1%
  </span>
  <span class="absValue">
    (13/68)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50,6%
  </span>
  <span class="absValue">
    (42/83)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    53,1%
  </span>
  <span class="absValue">
    (287/540)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package service
&nbsp;
&nbsp;import entity.*
&nbsp;import kotlin.random.Random.Default.nextBoolean
&nbsp;
&nbsp;/**
&nbsp; *this class control the game.
&nbsp; * @param rootService to access the entity layer.
&nbsp; */
<b class="fc">&nbsp;class GameService(private var rootService: RootService) : AbstractRefreshingService() {</b>
&nbsp;
&nbsp;    /**
&nbsp;     *the game will start from here and the cards will be shuffled
&nbsp;     * this methode use the createCards methode two create the cards
&nbsp;     * and distribute the 52 cards in the right stack and hands of player
&nbsp;     * @param playerOne name of first player.
&nbsp;     * @param playerTwo name of second player.
&nbsp;     * @throws IllegalArgumentException if one or both of the names is empty.
&nbsp;     * @throws IllegalStateException if game is already running.
&nbsp;     */
&nbsp;    fun startNewGame(playerOne : String, playerTwo : String){
&nbsp;
&nbsp;        //check if a game is running.
<b class="pc">&nbsp;        if(this.rootService.currentGame != null){</b>
<b class="nc">&nbsp;            throw IllegalStateException(&quot;Game already running&quot;)</b>
&nbsp;        }
&nbsp;
<b class="pc">&nbsp;        if (playerOne.isEmpty() || playerTwo.isEmpty()){</b>
<b class="nc">&nbsp;            throw IllegalArgumentException(&quot;player have to give a name!&quot;)</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        val allCards : MutableList&lt;ArrayDeque&lt;Card&gt;&gt; = creatCards()</b>
&nbsp;
<b class="fc">&nbsp;        val drawStackOne = allCards[0]</b>
<b class="fc">&nbsp;        val drawStackTwo = allCards[1]</b>
&nbsp;
<b class="fc">&nbsp;        val handCardsOne = allCards[2]</b>
<b class="fc">&nbsp;        val handCardsTwo = allCards[3]</b>
&nbsp;
&nbsp;        //take one card from stack and put it in the playStackOne
<b class="fc">&nbsp;        val playStackOne = ArrayDeque&lt;Card&gt;()</b>
<b class="fc">&nbsp;        playStackOne.add(drawStackOne[0])</b>
&nbsp;        //remove the card, so it does not exist twice.
<b class="fc">&nbsp;        drawStackOne.removeAt(0)</b>
&nbsp;
&nbsp;        //do the same as for playStackTwo
<b class="fc">&nbsp;        val playStackTwo = ArrayDeque&lt;Card&gt;()</b>
<b class="fc">&nbsp;        playStackTwo.add(drawStackTwo[0])</b>
<b class="fc">&nbsp;        drawStackTwo.removeAt(0)</b>
&nbsp;
&nbsp;        //the currentPlayer will be selected randomly through nextBoolean()
<b class="fc">&nbsp;        val gameUpAndDown = GameUpAndDown(</b>
<b class="fc">&nbsp;            playerOne = Player(playerOne, handCardsOne, drawStackOne),</b>
<b class="fc">&nbsp;            playerTwo = Player(playerTwo, handCardsTwo, drawStackTwo),</b>
<b class="fc">&nbsp;            currentPlayer = nextBoolean(),</b>
<b class="fc">&nbsp;            lastSkip = false,</b>
<b class="fc">&nbsp;            playerAction = false,</b>
<b class="fc">&nbsp;            playStackOne = playStackOne,</b>
<b class="fc">&nbsp;            playStackTwo = playStackTwo</b>
&nbsp;        )
<b class="fc">&nbsp;        rootService.currentGame = gameUpAndDown</b>
&nbsp;
<b class="pc">&nbsp;        onAllRefreshables { refreshAfterStartNewGame() }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * start new turn after the [GameUpAndDown] is started.
&nbsp;     * @throws IllegalStateException when the game is not running.
&nbsp;     */
&nbsp;    fun startTurn(){
&nbsp;
<b class="nc">&nbsp;        if(rootService.currentGame != null){</b>
&nbsp;            //determine which player play
<b class="nc">&nbsp;            val currentPlayer : Player? = rootService.gameService.currentPlayer()</b>
&nbsp;
<b class="nc">&nbsp;            if (currentPlayer  == rootService.currentGame?.playerOne){</b>
&nbsp;                //playerTwo can start his turn.
<b class="nc">&nbsp;                rootService.currentGame?.currentPlayer = false</b>
<b class="nc">&nbsp;                onAllRefreshables { refreshAfterStartTurn() }</b>
&nbsp;            }else{
&nbsp;                //in this case the currentPlayer is playerTwo, so playerOne can start his  turn.
<b class="nc">&nbsp;                rootService.currentGame?.currentPlayer = true</b>
<b class="nc">&nbsp;                onAllRefreshables { refreshAfterStartTurn() }</b>
&nbsp;            }
&nbsp;        }else{
<b class="nc">&nbsp;            throw IllegalStateException(&quot;The game is not started!.&quot;)</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Ends the current turn.
&nbsp;     * set the playerAction to false, so the next player can make action
&nbsp;     * false indicate that player did not make any action.
&nbsp;     * when player make action like:  playCard , swapHand, drawCard, the playerAction should be then set to true
&nbsp;     * to prevent the player making another action in the same turn.
&nbsp;     * @throws IllegalStateException when the game is not running.
&nbsp;     */
&nbsp;    fun endTurn() {
<b class="nc">&nbsp;        val game = rootService.currentGame ?: throw IllegalStateException(&quot;Game not started!&quot;)</b>
&nbsp;
<b class="nc">&nbsp;        if(rootService.currentGame?.playerAction == false){</b>
&nbsp;            return
&nbsp;        }
&nbsp;
&nbsp;        // Check if a player has won by emptying both hand and draw stacks.
<b class="nc">&nbsp;        val currentPlayer = currentPlayer()</b>
<b class="nc">&nbsp;        if ((currentPlayer?.handCards?.isEmpty() == true) &amp;&amp; currentPlayer.drawStack.isEmpty()){</b>
<b class="nc">&nbsp;            endGame()</b>
&nbsp;            return
&nbsp;        }
<b class="nc">&nbsp;        rootService.currentGame?.playerAction = false</b>
&nbsp;
&nbsp;        //cards of currentPlayer could be covered so another player can not see them.
<b class="nc">&nbsp;        onAllRefreshables { refreshAfterEndTurn() }</b>
&nbsp;        // Start the next turn.
&nbsp;        //startTurn()
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Ends the game and determines the winner.
&nbsp;     * The game ends either when a player has no cards left or when both players pass consecutively.
&nbsp;     * @throws IllegalStateException when the game is not running.
&nbsp;     */
&nbsp;    fun endGame() : String {
<b class="nc">&nbsp;        val game = rootService.currentGame ?: throw IllegalStateException(&quot;Game not started!&quot;)</b>
&nbsp;
<b class="nc">&nbsp;        val playerOne = game.playerOne</b>
<b class="nc">&nbsp;        val playerTwo = game.playerTwo</b>
<b class="nc">&nbsp;        var winnerName : String</b>
&nbsp;
&nbsp;        // Check if a player has emptied both hand and draw stack.
<b class="nc">&nbsp;        if (playerOne.handCards.isEmpty() &amp;&amp; playerOne.drawStack.isEmpty()) {</b>
<b class="nc">&nbsp;            winnerName = playerOne.name</b>
<b class="nc">&nbsp;            return &quot;${playerOne.name} wins&quot;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (playerTwo.handCards.isEmpty() &amp;&amp; playerTwo.drawStack.isEmpty()) {</b>
<b class="nc">&nbsp;            winnerName = playerTwo.name</b>
<b class="nc">&nbsp;            return &quot;${playerTwo.name} wins&quot;</b>
&nbsp;        }
&nbsp;
&nbsp;        // If both players passed consecutively, determine the winner by the fewest hand cards.
<b class="nc">&nbsp;        val handCountOne = playerOne.handCards.size</b>
<b class="nc">&nbsp;        val handCountTwo = playerTwo.handCards.size</b>
<b class="nc">&nbsp;        when {</b>
<b class="nc">&nbsp;            handCountOne &lt; handCountTwo -&gt; winnerName = playerOne.name</b>
<b class="nc">&nbsp;            handCountTwo &lt; handCountOne -&gt; winnerName = playerTwo.name</b>
<b class="nc">&nbsp;            else -&gt; winnerName = &quot;The game is a draw!&quot;</b>
&nbsp;        }
<b class="nc">&nbsp;        onAllRefreshables { refreshAfterEndGame(winnerName) }</b>
<b class="nc">&nbsp;        return winnerName</b>
&nbsp;    }
&nbsp;
&nbsp;    /****************************************Help Methode************************************************/
&nbsp;
&nbsp;    /**
&nbsp;     *alle the [Card] will be created and shuffled und then returned as list of  [ArrayDeque] in List
&nbsp;     * @return MutableList&lt;ArrayDeque&lt;Card&gt;&gt; which have all cards separated in two drawStack and two hands.
&nbsp;     */
&nbsp;    fun creatCards(): MutableList&lt;ArrayDeque&lt;Card&gt;&gt; {
<b class="fc">&nbsp;        val allCards : MutableList&lt;Card&gt; = mutableListOf()</b>
&nbsp;
<b class="fc">&nbsp;        val cardSuites = setOf(CardSuit.CLUBS, CardSuit.DIAMONDS, CardSuit.HEARTS, CardSuit.SPADES)</b>
&nbsp;
<b class="fc">&nbsp;        val cardValues = setOf(</b>
<b class="fc">&nbsp;            CardValue.TWO, CardValue.THREE, CardValue.FOUR, CardValue.FIVE,</b>
<b class="fc">&nbsp;            CardValue.SIX, CardValue.SEVEN, CardValue.EIGHT, CardValue.NINE,</b>
<b class="fc">&nbsp;            CardValue.TEN, CardValue.JACK, CardValue.QUEEN, CardValue.KING, CardValue.ACE</b>
&nbsp;        )
&nbsp;
&nbsp;         // for each iteration will creat one CardValue with four suite.
<b class="fc">&nbsp;        for (card in cardSuites) {</b>
<b class="fc">&nbsp;            for (value in cardValues) {</b>
<b class="fc">&nbsp;                allCards.add(Card(card, value))</b>
&nbsp;            }
&nbsp;        }
&nbsp;        //the cards will be shuffled.
<b class="fc">&nbsp;        allCards.shuffle()</b>
&nbsp;
&nbsp;        /**list that hold the cardsList
&nbsp;         * List[0] hold DrawStack for the first Player
&nbsp;         * List[1] hold DrawStack for the second Player
&nbsp;         * List[2] hold 5 handCards for the firstPlayer
&nbsp;         * List[3] hold 5 handCards for the secondPlayer
&nbsp;         */
<b class="fc">&nbsp;        val listOfCards = mutableListOf(</b>
<b class="fc">&nbsp;            ArrayDeque(allCards.subList(0, 21)),</b>
<b class="fc">&nbsp;            ArrayDeque(allCards.subList(21, 42)),</b>
<b class="fc">&nbsp;            ArrayDeque(allCards.subList(42, 47)),</b>
<b class="fc">&nbsp;            ArrayDeque(allCards.subList(47, 52))</b>
&nbsp;        )
<b class="fc">&nbsp;        return listOfCards</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * determine which player is playing now.
&nbsp;     * playerOne when currentPlayer true, playerTwo when currentPlayer false.
&nbsp;     * @return currentPlayer
&nbsp;     */
&nbsp;    fun currentPlayer() : Player?{
<b class="pc">&nbsp;        return if (rootService.currentGame?.currentPlayer == true){</b>
<b class="nc">&nbsp;            rootService.currentGame?.playerOne</b>
&nbsp;        }else{
<b class="pc">&nbsp;            rootService.currentGame?.playerTwo</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-03-02 23:59</div>
</div>
</body>
</html>
